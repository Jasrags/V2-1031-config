# Compare the GET_POSITION output before and after, see if you skipped steps. IIRC you want the "mcu" line to show within 16 before and after (a full step)
[gcode_macro SPEED_TEST]
gcode:
    #Parameters
    {% set i = params.I|default(1)|int %}
    {% set da = params.DIAGONAL_ACCEL|default(F27000)|int %}
    {% set la = params.LINEAR_ACCEL|default(F36000)|int %}
  
    SAVE_GCODE_STATE NAME=SPEED_TEST
    G28 X Y
    GET_POSITION
    G90
    {% for iteration in range(i|int) %}
        G1 X0 Y0     F{da}
        G1 X290 Y290 F{da}
        G1 X0 Y0     F{da}
        G1 X290 Y290 F{da}

        G1 X0 Y290 F{la}

        G1 X290 Y0 F{da}
        G1 X0 Y290 F{da}
        G1 X290 Y0 F{da}
        G1 X0 Y290 F{da}

        G1 X0 Y0 F{la}
        G1 X290 Y0 F{la}
        G1 X290 Y290 F{la}
        G1 X0 Y290 F{la}
        G1 X0 Y0 F{la}
    {% endfor %}
    G28 X Y
    GET_POSITION
    RESTORE_GCODE_STATE NAME=SPEED_TEST